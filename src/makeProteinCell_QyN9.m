function [atoms,cellDim] = makeProteinCell_QyN9()
%% This function calculates the location of all atoms in a small nanocrystal
%  of the peptide QYNNQNNFV using the atom locations from a PDB file.
%
% Marcus Gallagher-Jones 
% Department of Chemistry and Biochemistry, UCLA
% marcusgj@chem.ucla.edu
%
% Colin Ophus
% National Center for Electron Microscopy, LBNL
% 2017/19/09

% on zone cell
tileCells = [20 9 128/2]; 
u = [4.94       0           0];
v = [-u(1)*(4/9) 10.10648 0];
w = [-1.29356 * 0   -2.61931 * 0    31.0127];  % Shear onto zone axis

% Atomic coordinates
b = [0.381738007000000,0.405992627000000,0.866896749000000,7;0.917087197000000,0.949852109000000,0.859029233000000,7;0.602912545000000,0.509938836000000,0.974881947000000,7;0.516935706000000,0.701658010000000,0.0664548870000000,7;0.395308495000000,0.925282836000000,0.988488913000000,7;0.717869163000000,0.849657059000000,0.168023482000000,7;0.817494631000000,0.623919368000000,0.297837853000000,7;0.708816111000000,0.00549236200000000,0.273106694000000,7;0.306956351000000,0.431214273000000,0.387959808000000,7;0.851860821000000,0.105379559000000,0.385670513000000,7;0.576559246000000,0.795922041000000,0.375932813000000,7;0.774219871000000,0.259579152000000,0.489786357000000,7;0.859458566000000,0.628144205000000,0.458380699000000,7;0.991300881000000,0.289045125000000,0.601318359000000,7;0.924146473000000,0.427044392000000,0.700952351000000,7;0.539079130000000,0.512195587000000,0.897979975000000,6;0.555482268000000,0.644356728000000,0.879504204000000,6;0.760385752000000,0.766833127000000,0.901591301000000,6;0.722661018000000,0.890236795000000,0.882922053000000,6;0.426366627000000,0.511361361000000,0.942154288000000,6;0.523350596000000,0.493118048000000,0.0196043510000000,6;0.606324136000000,0.369994462000000,0.0382091370000000,6;0.543939292000000,0.337134719000000,0.0851886500000000,6;0.727791905000000,0.393821061000000,0.121076226000000,6;0.682036519000000,0.364075959000000,0.162122831000000,6;0.448493719000000,0.257907689000000,0.170925453000000,6;0.257439613000000,0.203836977000000,0.135586023000000,6;0.305333793000000,0.237042785000000,0.0937655490000000,6;0.673542976000000,0.625651598000000,0.0461411630000000,6;0.627675354000000,0.832540214000000,0.0896705610000000,6;0.520173907000000,0.945061743000000,0.0664226410000000,6;0.603527844000000,0.950511694000000,0.0190562050000000,6;0.522022963000000,0.831002831000000,0.135714993000000,6;0.654333353000000,0.834724665000000,0.212778151000000,6;0.713697314000000,0.697413146000000,0.227029994000000,6;0.632598758000000,0.664348125000000,0.271687925000000,6;0.833755136000000,0.947081327000000,0.242023468000000,6;0.864934385000000,0.106721789000000,0.306382477000000,6;0.922833264000000,0.249592155000000,0.289905816000000,6;0.164798573000000,0.348396242000000,0.314959377000000,6;0.0989447910000000,0.404815942000000,0.357843906000000,6;0.714818478000000,0.101490803000000,0.347332388000000,6;0.712907672000000,0.102996498000000,0.425008148000000,6;0.622556806000000,0.952757359000000,0.439775914000000,6;0.441038191000000,0.858438849000000,0.406822532000000,6;0.901057959000000,0.192384511000000,0.460702270000000,6;0.917438507000000,0.348699003000000,0.526737988000000,6;0.875657916000000,0.493407249000000,0.523094416000000,6;0.0157602350000000,0.562950909000000,0.483660012000000,6;0.801488042000000,0.303451449000000,0.570202887000000,6;0.921865582000000,0.249360040000000,0.643719256000000,6;0.00302606500000000,0.113782652000000,0.650909662000000,6;0.866175175000000,0.998493195000000,0.619890928000000,6;0.978213668000000,0.983128726000000,0.579650342000000,6;0.858543158000000,0.888748288000000,0.547986805000000,6;0.610387206000000,0.800373971000000,0.556724906000000,6;0.491420448000000,0.814186215000000,0.596320510000000,6;0.609205961000000,0.918811858000000,0.626662135000000,6;0.0751089080000000,0.356159240000000,0.678252518000000,6;0.0402715690000000,0.515702844000000,0.738032937000000,6;0.940217137000000,0.650690377000000,0.734679520000000,6;0.0763313920000000,0.757474124000000,0.769535303000000,6;0.958577812000000,0.698200524000000,0.689634681000000,6;0.914396882000000,0.459672242000000,0.779595435000000,6;0.729143918000000,0.498722076000000,0.900591731000000,1;0.371877193000000,0.663834095000000,0.879826605000000,1;0.606024206000000,0.635193348000000,0.849839687000000,1;0.948676884000000,0.756209671000000,0.898012221000000,1;0.726717353000000,0.775702119000000,0.932029665000000,1;0.928190172000000,0.0320144180000000,0.854579568000000,1;0.0331521630000000,0.907673359000000,0.847840548000000,1;0.193139017000000,0.425635159000000,0.859448433000000,1;0.481988251000000,0.401681423000000,0.841069341000000,1;0.357216358000000,0.322083175000000,0.879504204000000,1;0.322824001000000,0.483370006000000,0.0217002110000000,1;0.805293202000000,0.380683124000000,0.0363067460000000,1;0.514266491000000,0.292278647000000,0.0197010840000000,1;0.884825230000000,0.457388222000000,0.116271861000000,1;0.814171910000000,0.401737213000000,0.184145480000000,1;0.399100840000000,0.293473959000000,0.226901039000000,1;0.105996370000000,0.136624157000000,0.140067935000000,1;0.182219148000000,0.194968283000000,0.0711302680000000,1;0.809458196000000,0.520822942000000,0.972205698000000,1;0.830724120000000,0.854033470000000,0.0912827700000000,1;0.600607395000000,0.0303785020000000,0.0818030240000000,1;0.319304168000000,0.927960396000000,0.0664871260000000,1;0.407265246000000,0.977242112000000,0.963306308000000,1;0.231260896000000,0.854783118000000,0.991358638000000,1;0.308570743000000,0.673641443000000,0.0671642500000000,1;0.459226668000000,0.835034907000000,0.217034370000000,1;0.910874367000000,0.700525761000000,0.225675762000000,1;0.610896826000000,0.626107335000000,0.206909746000000,1;0.753002465000000,0.551910281000000,0.316281408000000,1;0.0151766930000000,0.666337132000000,0.298482716000000,1;0.923610091000000,0.875115097000000,0.163928494000000,1;0.0441306010000000,0.0850811970000000,0.312992513000000,1;0.756631613000000,0.284956038000000,0.291969419000000,1;0.969307721000000,0.242349222000000,0.260015607000000,1;0.224072069000000,0.422165066000000,0.297579885000000,1;0.316812873000000,0.304057091000000,0.319505811000000,1;0.277666301000000,0.408801168000000,0.413755000000000,1;0.470321298000000,0.470641673000000,0.381639987000000,1;0.501431823000000,0.985679090000000,0.276073128000000,1;0.544973373000000,0.138063237000000,0.421719283000000,1;0.521249652000000,0.955518782000000,0.465732336000000,1;0.787952542000000,0.919141650000000,0.445612073000000,1;0.480642438000000,0.711849868000000,0.360391200000000,1;0.767690241000000,0.835786998000000,0.369774193000000,1;0.0579743800000000,0.109629788000000,0.389475286000000,1;0.117074609000000,0.351423115000000,0.527705252000000,1;0.955016732000000,0.547556043000000,0.549179792000000,1;0.678406239000000,0.490923822000000,0.519999027000000,1;0.907673180000000,0.643915653000000,0.428716213000000,1;0.700761914000000,0.658706725000000,0.470182002000000,1;0.567247033000000,0.253712535000000,0.488528848000000,1;0.722508907000000,0.237720162000000,0.647298336000000,1;0.954863787000000,0.0904469860000000,0.679638982000000,1;0.201902509000000,0.124890909000000,0.648717046000000,1;0.141659066000000,0.0414004330000000,0.574265599000000,1;0.944854975000000,0.877964973000000,0.522385061000000,1;0.526318908000000,0.732801914000000,0.536121011000000,1;0.324022114000000,0.758189082000000,0.601318359000000,1;0.532163978000000,0.926184535000000,0.653231204000000,1;0.197296813000000,0.304938525000000,0.597352326000000,1;0.243182495000000,0.533721149000000,0.741128385000000,1;0.741771221000000,0.633942246000000,0.739548385000000,1;0.997427464000000,0.736639500000000,0.796459079000000,1;0.0446562130000000,0.842002690000000,0.762377083000000,1;0.271831125000000,0.760210216000000,0.771695673000000,1;0.130036607000000,0.685672820000000,0.678317070000000,1;0.951946020000000,0.790514350000000,0.690763235000000,1;0.805029273000000,0.647317469000000,0.671577990000000,1;0.720845222000000,0.423601031000000,0.694148839000000,1;0.510386825000000,0.930572271000000,0.890047967000000,8;0.179670215000000,0.522261500000000,0.947184324000000,8;0.417578161000000,0.225234747000000,0.211746350000000,8;0.933776855000000,0.655435085000000,0.0488174190000000,8;0.863097131000000,0.964756072000000,0.00986666400000000,8;0.268696725000000,0.806161284000000,0.141809106000000,8;0.399909139000000,0.672806025000000,0.284101874000000,8;0.0969866070000000,0.981861830000000,0.236864433000000,8;0.867660642000000,0.430933833000000,0.364324957000000,8;0.454111755000000,0.0936285260000000,0.346010357000000,8;0.178760886000000,0.843844652000000,0.407016009000000,8;0.155207187000000,0.193357468000000,0.463314056000000,8;0.258360565000000,0.562446296000000,0.477888316000000,8;0.546608925000000,0.272297412000000,0.574846029000000,8;0.328738302000000,0.373363495000000,0.684701383000000,8;0.651654005000000,0.431845248000000,0.780272543000000,8;0.0519737940000000,0.441948295000000,0.812419772000000,8;0.542970538000000,0.192279711000000,0.920969963000000,8;0.0583744050000000,0.190594152000000,0.961855352000000,8;];
% Remove h atoms
del = b(:,4) == 1;
b(del,:) = [];

% Overall cell dimensions
cellDim = [tileCells(1)*u(1) tileCells(2)*v(2) tileCells(3)*w(3)];

% Tile unit cells
[ya,xa,za] = meshgrid( ...
    0:(tileCells(2)-1),...
    0:(tileCells(1)-1),...
    0:(tileCells(3)-1));
p = [xa(:) ya(:) za(:)];
[pInd,bInd] = meshgrid(1:size(p,1),1:size(b,1));

a0 = p(pInd(:),1) + b(bInd(:),1);
b0 = p(pInd(:),2) + b(bInd(:),2);
c0 = p(pInd(:),3) + b(bInd(:),3);
ID = b(bInd(:),4);
xyz = repmat(a0,[1 3]) .* repmat(u,[length(a0) 1]) ...
    + repmat(b0,[1 3]) .* repmat(v,[length(a0) 1]) ...
    + repmat(c0,[1 3]) .* repmat(w,[length(a0) 1]);
atoms = [xyz ID];

for a0 = 1:3
    atoms(:,a0) = mod(atoms(:,a0), cellDim(a0));
end


for a0 = 1:3
    atoms(:,a0) = atoms(:,a0) / cellDim(a0);
end

end